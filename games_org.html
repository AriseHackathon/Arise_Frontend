<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organize Games - GameHub</title>

    <!-- header&footer -->
    <link rel="stylesheet" href="./styles/header.css">
    <link rel="stylesheet" href="./styles/footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="./styles/games_org.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

</head>

<body>

    <!-- header -->

    <div id="header">
        <header>
            <div class="logo">GAMESGRID</div>
            <nav id="header-nav">
                <a href="./index.html"><button type="button" aria-label="Home">Home</button></a>
                <a href="./games-page.html">
                    <button type="button" aria-label="Events">Events</button>
                </a>
                <a href="./library.html">
                    <button type="button" aria-label="Library">Library</button>
                </a>
                <a href="./blog.html">
                    <button type="button" aria-label="Blog">Blog</button>
                </a>
                <a href="./about.html">
                    <button type="button" aria-label="About">About</button>
                </a>
                <a href="./login.html">
                    <button type="button" aria-label="Signup" class="signup">Signup</button>
                </a>
            </nav>
        </header>
    </div>

    <div id="content-page">
        <div class="container">
            <div class="header">
                <h1><i class="fas fa-gamepad"></i> Game Organizer Dashboard</h1>
                <p>Create and manage amazing gaming experiences for your community</p>
            </div>

            <div class="dashboard">
                <div class="stats-panel">
                    <h3><i class="fas fa-chart-bar"></i> Your Statistics</h3>
                    <div id="statsContainer">
                        <div class="stat-item">
                            <span class="label">Total Games</span>
                            <span class="value" id="totalGames">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">Upcoming</span>
                            <span class="value" id="upcomingGames">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">Ongoing</span>
                            <span class="value" id="ongoingGames">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">Completed</span>
                            <span class="value" id="pastGames">0</span>
                        </div>
                    </div>
                </div>

                <div class="form-panel">
                    <h3><i class="fas fa-plus-circle"></i> Create New Game</h3>

                    <div class="alert alert-success" id="successAlert"></div>
                    <div class="alert alert-error" id="errorAlert"></div>

                    <form id="gameForm">
                        <div class="form-group">
                            <label for="title">Game Title *</label>
                            <input type="text" id="title" name="title" required placeholder="Enter game title">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="location">Location *</label>
                                <input type="text" id="location" name="location" required placeholder="Enter location">
                            </div>
                            <div class="form-group">
                                <label for="date">Date & Time *</label>
                                <input type="datetime-local" id="date" name="date" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="fee">Entry Fee (Rs.)</label>
                                <input type="number" id="fee" name="fee" min="0" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="maxParticipants">Max Participants</label>
                                <input type="number" id="maxParticipants" name="maxParticipants" min="1" value="20">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="status">Status</label>
                            <select id="status" name="status">
                                <option value="upcoming">Upcoming</option>
                                <option value="ongoing">Ongoing</option>
                                <option value="past">Past</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Game Icon</label>
                            <div class="icon-selector">
                                <div class="icon-option selected" data-icon="gamepad">
                                    <i class="fas fa-gamepad"></i>
                                    <span>Gaming</span>
                                </div>
                                <div class="icon-option" data-icon="volleyball-ball">
                                    <i class="fas fa-volleyball-ball"></i>
                                    <span>Volleyball</span>
                                </div>
                                <div class="icon-option" data-icon="basketball-ball">
                                    <i class="fas fa-basketball-ball"></i>
                                    <span>Basketball</span>
                                </div>
                                <div class="icon-option" data-icon="football-ball">
                                    <i class="fas fa-football-ball"></i>
                                    <span>Football</span>
                                </div>
                                <div class="icon-option" data-icon="table-tennis">
                                    <i class="fas fa-table-tennis"></i>
                                    <span>Ping Pong</span>
                                </div>
                                <div class="icon-option" data-icon="chess">
                                    <i class="fas fa-chess"></i>
                                    <span>Chess</span>
                                </div>
                            </div>
                            <input type="hidden" id="icon" name="icon" value="gamepad">
                        </div>

                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea id="description" name="description"
                                placeholder="Describe your game event..."></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Create Game
                        </button>
                    </form>
                </div>
            </div>

            <div class="games-list">
                <h3><i class="fas fa-list"></i> Your Games</h3>
                <div class="loading" id="gamesLoading">
                    <div class="spinner"></div>
                    <p>Loading your games...</p>
                </div>
                <div id="gamesList"></div>
            </div>
        </div>
    </div>

    <!-- footer -->
    <footer>
        <div class="footer-main">
            <div class="footer-logo" aria-label="Website Logo and privacy policy links">
                <img src="./assets/Group 1.png " alt="Website Logo" />
            </div>
            <div class="footer-container">
                <!-- Follow Us -->
                <div class="follow-us" aria-label="Follow us section">
                    <h3>Follow us</h3>
                    <div class="social-icons">
                        <a href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://facebook.com" target="_blank" rel="noopener" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://linkedin.com" target="_blank" rel="noopener" aria-label="Linkedin">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="https://github.com" target="_blank" rel="noopener" aria-label="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                    </div>
                </div>

                <!-- Useful Links -->
                <nav class="useful-links" aria-label="Useful links navigation">
                    <h3>Useful Links</h3>
                    <a href="#home" tabindex="0">Home</a>
                    <a href="#about" tabindex="0">About</a>
                    <a href="#blogs" tabindex="0">Blogs</a>
                    <a href="#events" tabindex="0">Events</a>
                    <a href="#library" tabindex="0">Library</a>
                </nav>

                <!-- Contact Information -->
                <section class="contact" aria-label="Contact information">
                    <h3>Contact</h3>
                    <div>Location: India</div>
                    <a href="mailto:contact@example.com" tabindex="0">Gmail: contact@example.com</a>
                    <div>Phone: +91 xxxxxxxxx</div>
                </section>

                <!-- Subscribe Section -->
                <div class="signup-container" aria-label="Subscribe section with email input">
                    <input type="email" placeholder="Enter your email" aria-label="Email address for subscription" />
                    <button id="subscribeBtn" aria-label="Subscribe for newsletter or updates">Subscribe</button>
                </div>

            </div>
        </div>
        <div class="footer-bottom" aria-label="Footer bottom text">
            <p>&copy; 2025 GAMESGRID. All rights reserved.</p>
        </div>
    </footer>


    <!-- games_org script -->

    <script>
        const API_BASE = 'https://arise-backend-m9zz.onrender.com';
        let selectedIcon = 'gamepad';

       // Add this script at the beginning of your games_org.html page, before the existing script

// User Authentication Verification
async function verifyUserAuthentication() {
    const token = localStorage.getItem('authToken');
    
    if (!token) {
        // No token found, redirect to login
        alert('Please login to access the games organizer dashboard.');
        window.location.href = './login.html';
        return false;
    }

    try {
        // Verify token with backend
        const response = await fetch(`${API_BASE}/users/verify-token`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const result = await response.json();
            
            if (result.success) {
                // Token is valid, store user info
                sessionStorage.setItem('currentUser', JSON.stringify(result.user));
                return true;
            } else {
                throw new Error('Token verification failed');
            }
        } else {
            throw new Error('Token verification failed');
        }
    } catch (error) {
        console.error('Authentication error:', error);
        
        // Remove invalid token
        localStorage.removeItem('authToken');
        sessionStorage.removeItem('currentUser');
        
        // Show error and redirect
        alert('Session expired or invalid. Please login again.');
        window.location.href = './login.html';
        return false;
    }
}

// Show loading screen while verifying
function showAuthLoadingScreen() {
    document.body.innerHTML = `
        <div style="
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(255,255,255,0.9); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 9999;
            flex-direction: column;
        ">
            <div style="
                width: 50px; 
                height: 50px; 
                border: 5px solid #f3f3f3; 
                border-top: 5px solid #3498db; 
                border-radius: 50%; 
                animation: spin 1s linear infinite;
            "></div>
            <p style="margin-top: 20px; font-size: 16px; color: #666;">Verifying authentication...</p>
        </div>
        <style>
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        </style>
    `;
}

// Initialize authentication check
async function initializeAuthenticatedPage() {
    // Show loading screen
    showAuthLoadingScreen();
    
    // Verify authentication
    const isAuthenticated = await verifyUserAuthentication();
    
    if (isAuthenticated) {
        // Reload the page to show the actual content
        window.location.reload();
    }
    // If not authenticated, user will be redirected by verifyUserAuthentication()
}

// Check authentication on page load
if (!sessionStorage.getItem('authChecked')) {
    sessionStorage.setItem('authChecked', 'true');
    initializeAuthenticatedPage();
} else {
    // Authentication already checked, proceed normally
    document.addEventListener('DOMContentLoaded', () => {
        loadStats();
        loadGames();
    });
}

        // Show alert messages
        function showAlert(message, type = 'success') {
            const alertElement = document.getElementById(type === 'success' ? 'successAlert' : 'errorAlert');
            alertElement.textContent = message;
            alertElement.style.display = 'block';

            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }

        // Icon selection
        document.querySelectorAll('.icon-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.icon-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedIcon = option.dataset.icon;
                document.getElementById('icon').value = selectedIcon;
            });
        });

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/games/stats/overview`);
                const stats = await response.json();

                document.getElementById('totalGames').textContent = stats.total || 0;
                document.getElementById('upcomingGames').textContent = stats.upcoming || 0;
                document.getElementById('ongoingGames').textContent = stats.ongoing || 0;
                document.getElementById('pastGames').textContent = stats.past || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load user's games
        async function loadGames() {
            const loadingElement = document.getElementById('gamesLoading');
            const gamesListElement = document.getElementById('gamesList');

            loadingElement.style.display = 'block';

            try {
                const response = await fetch(`${API_BASE}/games`);
                const games = await response.json();

                loadingElement.style.display = 'none';

                if (games.length === 0) {
                    gamesListElement.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No games created yet. Create your first game above!</p>';
                    return;
                }

                gamesListElement.innerHTML = games.map(game => `
                    <div class="game-card">
                        <div class="game-header">
                            <div class="game-title">
                                <i class="fas fa-${game.icon}"></i>
                                <h4>${game.title}</h4>
                            </div>
                            <span class="game-status status-${game.status}">${game.status.toUpperCase()}</span>
                        </div>
                        <div class="game-details">
                            <div class="game-detail">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${game.location}</span>
                            </div>
                            <div class="game-detail">
                                <i class="fas fa-calendar"></i>
                                <span>${new Date(game.date).toLocaleDateString()}</span>
                            </div>
                            <div class="game-detail">
                                <i class="fas fa-users"></i>
                                <span>${game.currentParticipants}/${game.maxParticipants} participants</span>
                            </div>
                            <div class="game-detail">
                                <i class="fas fa-dollar-sign"></i>
                                <span>$${game.fee || 0}</span>
                            </div>
                        </div>
                        ${game.description ? `<p style="color: #666; margin-bottom: 15px;">${game.description}</p>` : ''}
                        <div class="game-actions">
                            <button class="btn btn-secondary btn-small" onclick="editGame('${game._id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="deleteGame('${game._id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                loadingElement.style.display = 'none';

            }
        }

        // Create game form submission
        document.getElementById('gameForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const gameData = {
                title: formData.get('title'),
                location: formData.get('location'),
                date: formData.get('date'),
                fee: parseFloat(formData.get('fee')) || 0,
                status: formData.get('status'),
                icon: selectedIcon,
                description: formData.get('description'),
                maxParticipants: parseInt(formData.get('maxParticipants')) || 20,
                currentParticipants: 0,
                participants: []
            };

            try {
                const response = await fetch(`${API_BASE}/games`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify(gameData)
                });

                if (response.ok) {
                    showAlert('Game created successfully!');
                    e.target.reset();
                    selectedIcon = 'gamepad';
                    document.querySelectorAll('.icon-option').forEach(opt => opt.classList.remove('selected'));
                    document.querySelector('[data-icon="gamepad"]').classList.add('selected');
                    loadGames();
                    loadStats();
                } else {
                    const error = await response.json();
                    showAlert(error.message || 'Error creating game', 'error');
                }
            } catch (error) {
                console.error('Error creating game:', error);
                showAlert('Error creating game', 'error');
            }
        });

        // Edit game function
        async function editGame(gameId) {
            // This would open a modal or redirect to edit page
            // For now, just show an alert
            showAlert('Edit functionality would be implemented here');
        }

        // Delete game function
        async function deleteGame(gameId) {
            if (!confirm('Are you sure you want to delete this game?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games/${gameId}`, {
                    method: 'DELETE',
                    headers: getHeaders()
                });

                if (response.ok) {
                    showAlert('Game deleted successfully!');
                    loadGames();
                    loadStats();
                } else {
                    const error = await response.json();
                    showAlert(error.message || 'Error deleting game', 'error');
                }
            } catch (error) {
                console.error('Error deleting game:', error);
                showAlert('Error deleting game', 'error');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadGames();
        });
    </script>
</body>

</html>